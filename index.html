<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Show Today — Бронирование</title>
  <style>
    body {
      margin: 0; font-family: sans-serif; background: #f5f5f5; color: #333;
    }
    header {
      background: #ffffff; padding: 20px; text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header img { height: 50px; }
    main {
      padding: 20px; max-width: 500px; margin: auto;
      background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    fieldset {
      margin-bottom: 15px; border: none;
    }
    legend {
      font-weight: bold; margin-bottom: 8px;
    }
    label { display: block; margin-bottom: 5px; }
    input, select, button, textarea {
      width: 100%; padding: 8px; margin-bottom: 10px;
      border: 1px solid #ccc; border-radius: 4px;
      font-size: 16px;
    }
    button {
      background: #007aff; color: #fff; border: none;
      cursor: pointer; font-weight: bold;
    }
    button:disabled { background: #ccc; cursor: default; }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Show Today">
</header>

<main>
  <form id="booking-form">
    <!-- Шаг 1: формат -->
    <fieldset>
      <legend>Выберите формат</legend>
      <label><input type="radio" name="mode" value="studio" required> В студии</label>
      <label><input type="radio" name="mode" value="outdoor"> Выезд</label>
    </fieldset>

    <!-- Шаг 2: дата/время -->
    <fieldset>
      <legend>Дата и время</legend>
      <label>Дата: <input type="date" name="date" required></label>
      <label>Время: <input type="time" name="time" required></label>
    </fieldset>

    <!-- Шаг 3: подробности -->
    <fieldset>
      <legend>Подробности</legend>
      <label>Количество человек: <input type="number" name="count" min="1" required></label>
      <label id="address-label" style="display:none;">
        Адрес (для выезда): <input type="text" name="address">
      </label>
      <label>Программа:
        <select name="program" required>
          <option value="">— выберите —</option>
          <option value="classic">Классика</option>
          <option value="musicality">Musicality</option>
          <option value="battle">Battle Show</option>
          <option value="lotto">Музыкальное лото</option>
          <option value="kids">Детский формат</option>
          <option value="quiz">Квиз-мафия</option>
          <option value="21plus">Формат 21+</option>
        </select>
      </label>
      <label>Средний возраст участников: <input type="number" name="age" min="1" required></label>
      <label>Сколько раз были на нашем шоу: <input type="number" name="visits" min="0" required></label>
      <label>Повод праздника: <textarea name="occasion" rows="2" required></textarea></label>
    </fieldset>

    <button type="submit" id="submit-btn">Забронировать</button>
  </form>
</main>

<script>
  // Telegram WebApp API
  const tg = window.Telegram.WebApp;
  tg.expand();  // растягиваем WebApp под весь экран

  // Показ/скрытие поля "Адрес"
  const modeRadios = document.querySelectorAll('input[name="mode"]');
  const addressLabel = document.getElementById('address-label');
  modeRadios.forEach(r => {
    r.addEventListener('change', ()=> {
      addressLabel.style.display = (r.value === 'outdoor' && r.checked) ? 'block' : 'none';
      // если outdoor, делаем адрес обязательным:
      addressLabel.querySelector('input').required = (r.value==='outdoor' && r.checked);
    });
  });

  // Обработка отправки формы
  document.getElementById('booking-form').addEventListener('submit', e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    // отправляем JSON-строку боту
    tg.sendData(JSON.stringify({
      action: 'booking',
      timestamp: Date.now(),
      payload: data
    }));
    // меняем кнопку и показываем благодарность
    const btn = document.getElementById('submit-btn');
    btn.innerText = 'Отправлено!'; btn.disabled = true;
    setTimeout(()=>{
      document.body.innerHTML = '<p style="text-align:center; margin-top:50px;">Спасибо!<br>С вами свяжется администратор или ведущий для уточнения деталей.</p>';
    }, 500);
  });
</script>

</body>
</html>
